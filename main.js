(()=>{"use strict";class e{constructor(e,t,s,i,n,r,o){this._templateSelector=t,this._id=e._id,this._name=e.name,this._link=e.link,this._likes=e.likes,this._owner=e.owner,this._user=o,this._handleCardClick=s,this._articleElement=this._getArticleHTMLElement(),this._handleAddLikeClick=i,this._handleRemoveLikeClick=n,this._openConfirmPopup=r,this._deleteButtonElement=this._articleElement.querySelector(".element__delete-button"),this._likeButtonElement=this._articleElement.querySelector(".element__like"),this._cardTitle=this._articleElement.querySelector(".element__caption"),this._cardPicture=this._articleElement.querySelector(".element__image"),this._cardLikeCounter=this._articleElement.querySelector(".element__like-counter")}_handleDeleteCard=()=>{this._articleElement.remove()};_handleLikeCard=()=>{this._likeButtonElement.classList.contains("element__like_active")?this._handleRemoveLikeClick(this._id,this._toggleLikeColorAndCounter):this._handleAddLikeClick(this._id,this._toggleLikeColorAndCounter)};_toggleLikeColorAndCounter=e=>{this._likeButtonElement.classList.toggle("element__like_active"),this._cardLikeCounter.textContent=e.likes.length};_getArticleHTMLElement(){return document.querySelector(this._templateSelector).content.cloneNode(!0).querySelector(".element")}_addEventListeners=()=>{this._deleteButtonElement.addEventListener("click",(()=>{this._openConfirmPopup(this._handleDeleteCard,this._id)})),this._likeButtonElement.addEventListener("click",this._handleLikeCard),this._cardPicture.addEventListener("click",(()=>this._handleCardClick(this._link,this._name)))};createCard(){return this._cardPicture.src=this._link,this._cardPicture.alt=this._name,this._cardTitle.textContent=this._name,this._cardLikeCounter.textContent=this._likes.length,this._owner._id!==this._user._id&&(this._deleteButtonElement.style.display="none"),this._likes.some((e=>e._id===this._user._id))&&this._likeButtonElement.classList.add("element__like_active"),this._addEventListeners(),this._articleElement}}class t{constructor(e,t){this._form=t,this._config=e,this._inputList=Array.from(this._form.querySelectorAll(this._config.inputSelector)),this._button=this._form.querySelector(this._config.submitButtonSelector)}_showInputError=(e,t)=>{const s=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._config.inputErrorClass),s.textContent=t,s.classList.add(this._config.errorClass)};_hideInvalidInput=()=>this._inputList.some((e=>!e.validity.valid));resetValidation=()=>{this._toggleButtonState(),this._inputList.forEach((e=>{this._coverInputError(e)}))};_coverInputError=e=>{const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._config.inputErrorClass),console.log(t,"formError"),t.classList.remove(this._config.errorClass),t.textContent=""};_checkInvalidInput=e=>{e.validity.valid?this._coverInputError(e):this._showInputError(e,e.validationMessage)};_toggleButtonState=()=>{this._hideInvalidInput()?(this._button.classList.add(this._config.inactiveButtonClass),this._button.disabled=!0):(this._button.classList.remove(this._config.inactiveButtonClass),this._button.disabled=!1)};_setEventListeners=()=>{this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInvalidInput(e),this._toggleButtonState()}))}))};enableValidation(){this._toggleButtonState(),this._setEventListeners()}}class s{constructor({items:e,renderer:t},s){this._renderedItems=e,this._renderer=t,this._container=document.querySelector(s)}renderItems=e=>{this._renderedItems.forEach((t=>{const s=this._renderer(t,e);this.addItem(s)}))};addItem=e=>{this._container.prepend(e)}}class i{constructor(e){this._popup=document.querySelector(e)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEcsClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEcsClose)}_handleEcsClose=e=>{"Escape"===e.key&&this.close()};setEventListeners(){this._popup.addEventListener("click",(e=>{(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class n extends i{constructor(e,t){super(e),this._handleFormSubmit=t,this._formElement=this._popup.querySelector(".popup__form"),this._inputList=this._formElement.querySelectorAll(".popup__input"),this._popupSubmitBtn=this._popup.querySelector(".popup__button"),this._submitButtonInitialText=this._popupSubmitBtn.textContent}_getInputValues=()=>(this._formValues={},this._inputList.forEach((e=>{this._formValues[e.getAttribute("name")]=e.value})),this._formValues);setEventListeners=()=>{super.setEventListeners(),this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues(),this._setInitialText)}))};_setInitialText=()=>{this._popupSubmitBtn.textContent=this._submitButtonInitialText};setButtonText=e=>{this._popupSubmitBtn.textContent=e};close=()=>{super.close(),this._formElement.reset()}}const r={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},o=document.querySelector(".profile__edit"),a=document.querySelector(".popup-edit-form"),l=a.querySelector(".popup__input_type_name"),_=a.querySelector(".popup__input_type_job"),u=document.querySelector(".profile__button"),h=document.querySelector(".popup-add-form"),c=new class{constructor({baseUrl:e,headers:t}){this._url=e,this._headers=t}_addResult(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getInitialCards=()=>fetch(`${this._url}/cards`,{method:"GET",headers:this._headers}).then((e=>this._addResult(e)));addNewCard(e,t){return fetch(`${this._url}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((e=>this._addResult(e)))}deleteCard(e){return fetch(`${this._url}/cards/${e}`,{method:"DELETE",headers:this._headers}).then((e=>this._addResult(e)))}addLike(e){return fetch(`${this._url}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then((e=>this._addResult(e)))}deleteLike(e){return fetch(`${this._url}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then((e=>this._addResult(e)))}getUserInfo(){return fetch(`${this._url}/users/me`,{method:"GET",headers:this._headers}).then((e=>this._addResult(e)))}editUserInfo(e,t){return fetch(`${this._url}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then((e=>this._addResult(e)))}editUserAvatar(e){return fetch(`${this._url}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then((e=>this._addResult(e)))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-61/",headers:{authorization:"2ce1dc8c-3aac-4f5e-8755-ac62ac8c845a","Content-Type":"application/json"}});let d,p;Promise.all([c.getUserInfo(),c.getInitialCards()]).then((e=>{d=e[0],L.setUseInfo(e[0].name,e[0].about,e[0].avatar),p=new s({items:e[1],renderer:E},".elements"),p.renderItems(v.open)})).catch((e=>{console.log(e)}));const m=(e,t)=>{c.addLike(e).then((e=>{t(e)})).catch((e=>{console.log(e)}))},f=(e,t)=>{c.deleteLike(e).then((e=>{t(e)})).catch((e=>{console.log(e)}))},C=new class extends i{constructor(e,t){super(e),this._handleSubmitBtnClick=t,this._popupConfirmBtn=this._popup.querySelector(".popup__button"),this._submitButtonInitialText=this._popupConfirmBtn.textContent,this._currentDeleteCardCallback=null,this._currentCardId=null}open=(e,t)=>{super.open(),this._currentDeleteCardCallback=e,this._currentCardId=t};_setInitialText=()=>{this._popupConfirmBtn.textContent=this._submitButtonInitialText};setButtonText=e=>{this._popupConfirmBtn.textContent=e};setEventListeners=()=>{super.setEventListeners(),this._popupConfirmBtn.addEventListener("click",(()=>{this._popupConfirmBtn.textContent="Удаление...",this._handleSubmitBtnClick(this._currentCardId,this._setInitialText,this._currentDeleteCardCallback)}))}}(".popup_type_delete-picture",((e,t,s)=>{c.deleteCard(e).then((e=>{s(),C.close()})).catch((e=>{console.log(e)})).finally((()=>t()))}));C.setEventListeners();const v=new class extends i{constructor(e){super(e),this._popupImageBig=this._popup.querySelector(".popup__image"),this._popupHeadingBig=this._popup.querySelector(".popup-image-heading")}open=(e,t)=>{super.open(),this._popupImageBig.src=e,this._popupImageBig.alt=t,this._popupHeadingBig.textContent=t}}("#popup-big-picture");v.setEventListeners();const E=t=>new e(t,".card__template",v.open,m,f,C.open,d).createCard(),g=new n(".popup_type_profile",((e,t)=>{g.setButtonText("Сохранение..."),c.editUserInfo(e.popup__name,e.popup__job).then((e=>{L.setUseInfo(e.name,e.about,e.avatar),g.close()})).catch((e=>{console.log(e)})).finally((()=>t()))}));g.setEventListeners();const k=new n(".popup_type_add-card",((e,t)=>{k.setButtonText("Сохранение..."),c.addNewCard(e.popup__input_type_place,e.popup__link).then((e=>{p.addItem(E(e)),k.close()})).catch((e=>{console.log(e)})).finally((()=>t()))}));k.setEventListeners();const L=new class{constructor({userNameSelector:e,userInfoSelector:t,userAvatarSelector:s}){this._userName=document.querySelector(e),this._userInfo=document.querySelector(t),this._userAvatar=document.querySelector(s)}getUserInfo(){return{name:this._userName.textContent,info:this._userInfo.textContent}}setUseInfo=(e,t,s)=>{this._userName.textContent=e,this._userInfo.textContent=t,this.setUserAvatar(s)};setUserAvatar(e){this._userAvatar.src=e}}({userNameSelector:".profile__name",userInfoSelector:".profile__job",userAvatarSelector:".profile__avatar"});o.addEventListener("click",(function(){const e=L.getUserInfo();l.value=e.name,_.value=e.info,g.open()})),u.addEventListener("click",(function(){S.resetValidation(),k.open()}));const S=new t(r,h);S.enableValidation(),new t(r,a).enableValidation();const y=new t(r,document.querySelector(".popup-change-avatar-form"));y.enableValidation();const b=new n(".popup_type_change-avatar",((e,t)=>{b.setButtonText("Сохранение..."),c.editUserAvatar(e["popup__avatar-link"]).then((e=>{L.setUserAvatar(e.avatar),b.close()})).catch((e=>{console.log(e)})).finally((()=>t()))}));b.setEventListeners(),document.querySelector(".profile__edit-avatar-button").addEventListener("click",(()=>{y.resetValidation(),b.open()}))})();